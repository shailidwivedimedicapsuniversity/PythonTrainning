/**
 * @fileoverview added by tsickle
 * Generated from: lib/pages/questionnaire/choice/choice.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, EventEmitter, Input, Output } from '@angular/core';
import { Question } from '../../pages.model';
import { SurveyResponses } from '../../survey-response.model';
import { PagesService } from '../../../shared/pages-services/pages.service';
export class ChoiceComponent {
    /**
     * @param {?} pageService
     */
    constructor(pageService) {
        this.pageService = pageService;
        this.isActive = false;
        this.submitEvent = new EventEmitter();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set isMultipleChoice(value) {
        this._isMultipleChoice = value;
        console.log('Inside isMultipleChoice');
        console.log(value);
        this.choiceQuestion.choices.forEach((/**
         * @param {?} choice
         * @return {?}
         */
        choice => choice.isChecked = false));
    }
    /**
     * @return {?}
     */
    get isMultipleChoice() {
        return this._isMultipleChoice;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        console.warn(this.surveyResponse);
        if (this.surveyResponse.choices !== undefined) {
            this.surveyResponse.choices.forEach((/**
             * @param {?} choice
             * @return {?}
             */
            choice => choice.isChecked = true));
        }
        if (this.pageService.stage == 'entry-next') {
            document.getElementById('choice-question').className = 'entry-next';
            document.getElementById('choice-question-delay').className = 'entry-next-delay';
        }
        else if (this.pageService.stage == 'entry-previous') {
            document.getElementById('choice-question').className = 'entry-previous-delay';
            document.getElementById('choice-question-delay').className = 'entry-previous';
        }
    }
    /**
     * @return {?}
     */
    submit() {
        this.isActive = true;
        this.surveyResponse.choices = this.selectedOptions;
        if (this.surveyResponse.choices != undefined &&
            this.surveyResponse.choices.length > 0) {
            this.surveyResponse.questionId = this.choiceQuestion.questionId;
            this.surveyResponse.question = this.choiceQuestion.question;
            this.surveyResponse.questionType = this.choiceQuestion.questionType;
            this.surveyResponse.identifier = this.choiceQuestion.identifier;
            this.pageService.persistSurvey(this.surveyResponse);
        }
        document.getElementById('btn-primary').classList.add('blink-btn-animation');
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.submitEvent.emit();
        }), 350);
    }
    /**
     * @return {?}
     */
    get selectedOptions() {
        return this.choiceQuestion.choices
            .filter((/**
         * @param {?} choice
         * @return {?}
         */
        choice => choice.isChecked))
            .map((/**
         * @param {?} opt
         * @return {?}
         */
        opt => opt));
    }
    /**
     * @private
     * @param {?} choices
     * @return {?}
     */
    changeSelection(choices) {
        if (typeof choices !== 'undefined') {
            choices.forEach((/**
             * @param {?} choice
             * @return {?}
             */
            choice => {
                this.choiceQuestion.choices.forEach((/**
                 * @param {?} c
                 * @return {?}
                 */
                c => {
                    if (choice.choiceId == c.choiceId) {
                        c.isChecked = true;
                    }
                }));
            }));
        }
    }
    /**
     * @return {?}
     */
    onClickOthers() {
        if (!this.choiceQuestion.others.isChecked) {
            this.choiceQuestion.others.isChecked = true;
            this.choiceQuestion.others.showCheckbox = false;
        }
        else {
            this.choiceQuestion.others.isChecked = false;
            this.choiceQuestion.others.showCheckbox = true;
        }
    }
    /**
     * @return {?}
     */
    onInputOthers() {
        this.choiceQuestion.others.isChecked = true;
        this.choiceQuestion.others.showCheckbox = true;
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onOptionSelectionChange($event) {
        if ($event) {
            this.choiceQuestion.attributes.numberOfSelection++;
        }
        else {
            this.choiceQuestion.attributes.numberOfSelection--;
        }
    }
    /**
     * @param {?} identifier
     * @return {?}
     */
    onSingleSelect(identifier) {
        this.choiceQuestion.choices.forEach((/**
         * @param {?} choice
         * @return {?}
         */
        choice => choice.isChecked = false));
        /** @type {?} */
        let index = this.choiceQuestion.choices.findIndex((/**
         * @param {?} choice
         * @return {?}
         */
        choice => choice.identifier == identifier));
        if (index > 0) {
            this.choiceQuestion.choices[index].isChecked = true;
        }
    }
    /**
     * @param {?} choice
     * @return {?}
     */
    isDisabled(choice) {
        if (this.choiceQuestion.attributes.selection == undefined)
            return false;
        else if (this.choiceQuestion.attributes.selection.type == 'Exact') {
            return this.choiceQuestion.attributes.numberOfSelection >= this.choiceQuestion.attributes.selection.exact
                && !choice.isChecked;
        }
        else if (this.choiceQuestion.attributes.selection.type == 'Range') {
            return this.choiceQuestion.attributes.numberOfSelection >= this.choiceQuestion.attributes.selection.rangeTo
                && !choice.isChecked;
        }
        else
            return false;
    }
}
ChoiceComponent.decorators = [
    { type: Component, args: [{
                selector: 'app-choice',
                template: "<div id=\"choice-question\">\n\n  <div class=\"survey-statement\">\n    <span *ngIf=\"choiceQuestion.attributes.required\" class=\"isRequired\">*</span>{{choiceQuestion.question}}\n  </div>\n  <p class=\"question-description\">\n    {{choiceQuestion.attributes.description}}\n  </p>\n\n</div>\n<div id=\"choice-question-delay\">\n\n  <ng-container *ngIf=\"isMultipleChoice; else singleSelection\">\n\n    <div *ngFor=\"let c of choiceQuestion.choices; index as choiceIndex\">\n      <label>\n        <input class=\"multiple-choice-checkbox\" type=\"checkbox\" name=\"option {{choiceIndex}}\"\n               (ngModelChange)=\"onOptionSelectionChange($event)\"\n               [disabled]=\"isDisabled(c)\"\n               [(ngModel)]=\"c.isChecked\"/>\n        <span class=\"btn-secondary multiple-choice\">{{c.text}}</span>\n      </label>\n    </div>\n\n\n    <div *ngIf=\"choiceQuestion.attributes.others && choiceQuestion.others != undefined\">\n      <label *ngIf=\"choiceQuestion.others.showCheckbox\">\n        <input type=\"checkbox\" name=\"Others\" style=\"display: none;\"\n               (click)=\"onClickOthers()\"\n               [(ngModel)]=\"choiceQuestion.others.isChecked\"/>\n        <span class=\"btn-secondary multiple-choice\">{{choiceQuestion.others.value}}</span>\n      </label>\n      <div *ngIf=\"!choiceQuestion.others.showCheckbox\">\n      <span class=\"btn-secondary multiple-choice\">\n            <input type=\"text\"\n                   appAutofocus\n                   [(ngModel)]=\"choiceQuestion.others.value\"\n                   class=\"multiple-choice-editableTextBox\">\n            <button (click)=\"onInputOthers()\"\n                    class=\"btn editable-others\">&#10004;</button>\n      </span>\n      </div>\n    </div>\n  </ng-container>\n\n  <ng-template #singleSelection>\n    <div\n      *ngFor=\"let c of choiceQuestion.choices; index as choiceIndex\">\n      <label>\n        <input class=\"multiple-choice-radio-btn\"\n               type=\"radio\"\n               name=\"radio_name\"\n               [id]=\"choiceIndex\"\n               [value]=\"c.identifier\"\n               (change)=\"onSingleSelect(c.identifier)\"\n               [checked]=\"c.isChecked\"\n        />\n        <span class=\"multiple-choice\">{{c.text}}</span>\n      </label>\n    </div>\n  </ng-template>\n\n  <button class=\"btn-primary\" id=\"btn-primary\" (click)=\"submit()\">{{isLastQuestion?'Submit': 'Done'}}</button>\n  <span *ngIf=\"!choiceQuestion.attributes.required\" (click)=\"submit()\"\n        class=\"skip-this-question skip-this-question-marginLeft\">Skip</span>\n</div>\n",
                styles: [".multiple-choice-radio-btn{display:none}.editable-others{padding:0 4%;border:1px solid var(--white-25);margin:1.6% 1% 0 0}.editable-others:active,.editable-others:focus{border:1px solid var(--white-25)}.multiple-choice-editableTextBox{width:85%!important;height:28px!important;border:none!important;padding-left:2%!important;margin:0!important;font-size:inherit;color:var(--text-color-secondary)}.multiple-choice-editableTextBox:active,.multiple-choice-editableTextBox:focus{outline:0!important}.mcq-disabled{background:0 0;cursor:not-allowed}.mcq-subcategory{padding-left:15px}"]
            }] }
];
/** @nocollapse */
ChoiceComponent.ctorParameters = () => [
    { type: PagesService }
];
ChoiceComponent.propDecorators = {
    choiceQuestion: [{ type: Input }],
    surveyResponse: [{ type: Input }],
    submitEvent: [{ type: Output }],
    isLastQuestion: [{ type: Input }],
    isMultipleChoice: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    ChoiceComponent.prototype.isActive;
    /** @type {?} */
    ChoiceComponent.prototype.choiceQuestion;
    /** @type {?} */
    ChoiceComponent.prototype.surveyResponse;
    /** @type {?} */
    ChoiceComponent.prototype.submitEvent;
    /** @type {?} */
    ChoiceComponent.prototype.isLastQuestion;
    /**
     * @type {?}
     * @private
     */
    ChoiceComponent.prototype._isMultipleChoice;
    /**
     * @type {?}
     * @private
     */
    ChoiceComponent.prototype.pageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hvaWNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3N1cnZleS1saWIvIiwic291cmNlcyI6WyJsaWIvcGFnZXMvcXVlc3Rpb25uYWlyZS9jaG9pY2UvY2hvaWNlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBQyxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBVSxNQUFNLEVBQUMsTUFBTSxlQUFlLENBQUM7QUFDN0UsT0FBTyxFQUFTLFFBQVEsRUFBQyxNQUFNLG1CQUFtQixDQUFDO0FBQ25ELE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSw2QkFBNkIsQ0FBQztBQUM1RCxPQUFPLEVBQUMsWUFBWSxFQUFDLE1BQU0sOENBQThDLENBQUM7QUFRMUUsTUFBTSxPQUFPLGVBQWU7Ozs7SUErQjFCLFlBQW9CLFdBQXlCO1FBQXpCLGdCQUFXLEdBQVgsV0FBVyxDQUFjO1FBN0I3QyxhQUFRLEdBQVUsS0FBSyxDQUFDO1FBUXhCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQXdCakMsQ0FBQzs7Ozs7SUFoQkQsSUFBYSxnQkFBZ0IsQ0FBQyxLQUFjO1FBQzFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7UUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsT0FBTzs7OztRQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLFNBQVMsR0FBRyxLQUFLLEVBQUMsQ0FBQztJQUMxRSxDQUFDOzs7O0lBR0QsSUFBSSxnQkFBZ0I7UUFDbEIsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUM7SUFDaEMsQ0FBQzs7OztJQVFELFFBQVE7UUFDTixPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENB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SW5wdXQsIE9uSW5pdCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q2hvaWNlLCBRdWVzdGlvbn0gZnJvbSAnLi4vLi4vcGFnZXMubW9kZWwnO1xuaW1wb3J0IHtTdXJ2ZXlSZXNwb25zZXN9IGZyb20gJy4uLy4uL3N1cnZleS1yZXNwb25zZS5tb2RlbCc7XG5pbXBvcnQge1BhZ2VzU2VydmljZX0gZnJvbSAnLi4vLi4vLi4vc2hhcmVkL3BhZ2VzLXNlcnZpY2VzL3BhZ2VzLnNlcnZpY2UnO1xuXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2FwcC1jaG9pY2UnLFxuICB0ZW1wbGF0ZVVybDogJy4vY2hvaWNlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY2hvaWNlLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBDaG9pY2VDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIGlzQWN0aXZlOiBib29sZWFuPWZhbHNlO1xuICBASW5wdXQoKVxuICBjaG9pY2VRdWVzdGlvbjogUXVlc3Rpb247XG5cbiAgQElucHV0KClcbiAgc3VydmV5UmVzcG9uc2U6IFN1cnZleVJlc3BvbnNlcztcblxuICBAT3V0cHV0KClcbiAgc3VibWl0RXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgQElucHV0KClcbiAgcHVibGljIGlzTGFzdFF1ZXN0aW9uOiBib29sZWFuO1xuXG4gIHByaXZhdGUgX2lzTXVsdGlwbGVDaG9pY2U6IGJvb2xlYW47XG5cblxuICBASW5wdXQoKSBzZXQgaXNNdWx0aXBsZUNob2ljZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2lzTXVsdGlwbGVDaG9pY2UgPSB2YWx1ZTtcbiAgICBjb25zb2xlLmxvZygnSW5zaWRlIGlzTXVsdGlwbGVDaG9pY2UnKTtcbiAgICBjb25zb2xlLmxvZyh2YWx1ZSk7XG4gICAgdGhpcy5jaG9pY2VRdWVzdGlvbi5jaG9pY2VzLmZvckVhY2goY2hvaWNlID0+IGNob2ljZS5pc0NoZWNrZWQgPSBmYWxzZSk7XG4gIH1cblxuXG4gIGdldCBpc011bHRpcGxlQ2hvaWNlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9pc011bHRpcGxlQ2hvaWNlO1xuICB9XG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBhZ2VTZXJ2aWNlOiBQYWdlc1NlcnZpY2UpIHtcblxuXG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBjb25zb2xlLndhcm4odGhpcy5zdXJ2ZXlSZXNwb25zZSk7XG4gICAgaWYgKHRoaXMuc3VydmV5UmVzcG9uc2UuY2hvaWNlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnN1cnZleVJlc3BvbnNlLmNob2ljZXMuZm9yRWFjaChjaG9pY2UgPT4gY2hvaWNlLmlzQ2hlY2tlZCA9IHRydWUpO1xuICAgIH1cbiAgICBpZiAodGhpcy5wYWdlU2VydmljZS5zdGFnZSA9PSAnZW50cnktbmV4dCcpIHtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaG9pY2UtcXVlc3Rpb24nKS5jbGFzc05hbWUgPSAnZW50cnktbmV4dCc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hvaWNlLXF1ZXN0aW9uLWRlbGF5JykuY2xhc3NOYW1lID0gJ2VudHJ5LW5leHQtZGVsYXknO1xuICAgIH1lbHNlIGlmICh0aGlzLnBhZ2VTZXJ2aWNlLnN0YWdlID09ICdlbnRyeS1wcmV2aW91cycpIHtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaG9pY2UtcXVlc3Rpb24nKS5jbGFzc05hbWUgPSAnZW50cnktcHJldmlvdXMtZGVsYXknO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nob2ljZS1xdWVzdGlvbi1kZWxheScpLmNsYXNzTmFtZSA9ICdlbnRyeS1wcmV2aW91cyc7XG4gICAgfVxuICB9XG5cbiAgc3VibWl0KCkge1xuICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xuICAgIHRoaXMuc3VydmV5UmVzcG9uc2UuY2hvaWNlcyA9IHRoaXMuc2VsZWN0ZWRPcHRpb25zO1xuICAgIGlmICh0aGlzLnN1cnZleVJlc3BvbnNlLmNob2ljZXMgIT0gdW5kZWZpbmVkICYmXG4gICAgICB0aGlzLnN1cnZleVJlc3BvbnNlLmNob2ljZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5zdXJ2ZXlSZXNwb25zZS5xdWVzdGlvbklkID0gdGhpcy5jaG9pY2VRdWVzdGlvbi5xdWVzdGlvbklkO1xuICAgICAgdGhpcy5zdXJ2ZXlSZXNwb25zZS5xdWVzdGlvbiA9IHRoaXMuY2hvaWNlUXVlc3Rpb24ucXVlc3Rpb247XG4gICAgICB0aGlzLnN1cnZleVJlc3BvbnNlLnF1ZXN0aW9uVHlwZSA9IHRoaXMuY2hvaWNlUXVlc3Rpb24ucXVlc3Rpb25UeXBlO1xuICAgICAgdGhpcy5zdXJ2ZXlSZXNwb25zZS5pZGVudGlmaWVyID0gdGhpcy5jaG9pY2VRdWVzdGlvbi5pZGVudGlmaWVyO1xuICAgICAgdGhpcy5wYWdlU2VydmljZS5wZXJzaXN0U3VydmV5KHRoaXMuc3VydmV5UmVzcG9uc2UpO1xuICAgIH1cbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuLXByaW1hcnknKS5jbGFzc0xpc3QuYWRkKCdibGluay1idG4tYW5pbWF0aW9uJyk7XG4gICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgdGhpcy5zdWJtaXRFdmVudC5lbWl0KCk7XG4gICAgfSwgMzUwKTtcbiAgfVxuXG4gIGdldCBzZWxlY3RlZE9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2hvaWNlUXVlc3Rpb24uY2hvaWNlc1xuICAgICAgLmZpbHRlcihjaG9pY2UgPT4gY2hvaWNlLmlzQ2hlY2tlZClcbiAgICAgIC5tYXAob3B0ID0+IG9wdCk7XG4gIH1cblxuXG4gIHByaXZhdGUgY2hhbmdlU2VsZWN0aW9uKGNob2ljZXM6IENob2ljZVtdKSB7XG4gICAgaWYgKHR5cGVvZiBjaG9pY2VzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgY2hvaWNlcy5mb3JFYWNoKGNob2ljZSA9PiB7XG4gICAgICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24uY2hvaWNlcy5mb3JFYWNoKGMgPT57XG4gICAgICAgICAgaWYgKGNob2ljZS5jaG9pY2VJZCA9PSBjLmNob2ljZUlkKXtcbiAgICAgICAgICAgIGMuaXNDaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cblxuICBvbkNsaWNrT3RoZXJzKCkge1xuXG4gICAgaWYgKCF0aGlzLmNob2ljZVF1ZXN0aW9uLm90aGVycy5pc0NoZWNrZWQpIHtcbiAgICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24ub3RoZXJzLmlzQ2hlY2tlZCA9IHRydWU7XG4gICAgICB0aGlzLmNob2ljZVF1ZXN0aW9uLm90aGVycy5zaG93Q2hlY2tib3ggPSBmYWxzZTtcbiAgICB9ZWxzZSB7XG4gICAgICB0aGlzLmNob2ljZVF1ZXN0aW9uLm90aGVycy5pc0NoZWNrZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24ub3RoZXJzLnNob3dDaGVja2JveCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgb25JbnB1dE90aGVycygpIHtcbiAgICB0aGlzLmNob2ljZVF1ZXN0aW9uLm90aGVycy5pc0NoZWNrZWQgPSB0cnVlO1xuICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24ub3RoZXJzLnNob3dDaGVja2JveCA9IHRydWU7XG5cbiAgfVxuXG4gIG9uT3B0aW9uU2VsZWN0aW9uQ2hhbmdlKCRldmVudCkge1xuICAgIGlmICgkZXZlbnQpIHtcbiAgICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24uYXR0cmlidXRlcy5udW1iZXJPZlNlbGVjdGlvbisrO1xuICAgIH1lbHNlIHtcbiAgICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24uYXR0cmlidXRlcy5udW1iZXJPZlNlbGVjdGlvbi0tO1xuICAgIH1cbiAgfVxuXG4gIG9uU2luZ2xlU2VsZWN0KGlkZW50aWZpZXI6IHN0cmluZykge1xuICAgIHRoaXMuY2hvaWNlUXVlc3Rpb24uY2hvaWNlcy5mb3JFYWNoKGNob2ljZSA9PiBjaG9pY2UuaXNDaGVja2VkID0gZmFsc2UpO1xuICAgIGxldCBpbmRleCA9IHRoaXMuY2hvaWNlUXVlc3Rpb24uY2hvaWNlcy5maW5kSW5kZXgoY2hvaWNlID0+IGNob2ljZS5pZGVudGlmaWVyID09IGlkZW50aWZpZXIpO1xuICAgIGlmIChpbmRleCA+IDApe1xuICAgICAgdGhpcy5jaG9pY2VRdWVzdGlvbi5jaG9pY2VzW2luZGV4XS5pc0NoZWNrZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gICBpc0Rpc2FibGVkKGNob2ljZTogQ2hvaWNlKXtcblxuICAgICBpZiAodGhpcy5jaG9pY2VRdWVzdGlvbi5hdHRyaWJ1dGVzLnNlbGVjdGlvbiA9PSB1bmRlZmluZWQpXG4gICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgIGVsc2UgaWYgKHRoaXMuY2hvaWNlUXVlc3Rpb24uYXR0cmlidXRlcy5zZWxlY3Rpb24udHlwZSA9PSAnRXhhY3QnKXtcbiAgICAgIHJldHVybiB0aGlzLmNob2ljZVF1ZXN0aW9uLmF0dHJpYnV0ZXMubnVtYmVyT2ZTZWxlY3Rpb24gPj0gdGhpcy5jaG9pY2VRdWVzdGlvbi5hdHRyaWJ1dGVzLnNlbGVjdGlvbi5leGFjdFxuICAgICAgICAmJiAhY2hvaWNlLmlzQ2hlY2tlZDtcblxuICAgIH1lbHNlIGlmICh0aGlzLmNob2ljZVF1ZXN0aW9uLmF0dHJpYnV0ZXMuc2VsZWN0aW9uLnR5cGUgPT0gJ1JhbmdlJykge1xuICAgICAgcmV0dXJuIHRoaXMuY2hvaWNlUXVlc3Rpb24uYXR0cmlidXRlcy5udW1iZXJPZlNlbGVjdGlvbiA+PSB0aGlzLmNob2ljZVF1ZXN0aW9uLmF0dHJpYnV0ZXMuc2VsZWN0aW9uLnJhbmdlVG9cbiAgICAgICAgJiYgIWNob2ljZS5pc0NoZWNrZWQ7XG4gICAgfSBlbHNlIHJldHVybiBmYWxzZTtcbiAgfVxufVxuIl19