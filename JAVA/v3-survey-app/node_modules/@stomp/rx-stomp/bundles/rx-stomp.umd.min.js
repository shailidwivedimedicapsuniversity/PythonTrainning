!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("rxjs"),require("rxjs/operators"),require("@stomp/stompjs")):"function"==typeof define&&define.amd?define("RxStomp",["rxjs","rxjs/operators","@stomp/stompjs"],t):"object"==typeof exports?exports.RxStomp=t(require("rxjs"),require("rxjs/operators"),require("@stomp/stompjs")):e.RxStomp=t(e.rxjs,e.rxjs.operators,e.StompJs)}("undefined"!=typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(t.RxStompState||(t.RxStompState={}))},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),o(n(5)),o(n(6)),o(n(2)),o(n(8)),o(n(9))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){};t.RxStompConfig=o},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function u(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,s)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),u=n(1),s=n(7),c=n(2),a=function(){function e(){var e=this;this._queuedMessages=[],this._stompClient=new s.Client;var t=function(){};this._beforeConnect=t,this._debug=t,this._connectionStatePre$=new i.BehaviorSubject(c.RxStompState.CLOSED),this._connectedPre$=this._connectionStatePre$.pipe(u.filter((function(e){return e===c.RxStompState.OPEN}))),this.connectionState$=new i.BehaviorSubject(c.RxStompState.CLOSED),this.connected$=this.connectionState$.pipe(u.filter((function(e){return e===c.RxStompState.OPEN}))),this.connected$.subscribe((function(){e._sendQueuedMessages()})),this._serverHeadersBehaviourSubject$=new i.BehaviorSubject(null),this.serverHeaders$=this._serverHeadersBehaviourSubject$.pipe(u.filter((function(e){return null!==e}))),this.stompErrors$=new i.Subject,this.unhandledMessage$=new i.Subject,this.unhandledReceipts$=new i.Subject,this.unhandledFrame$=new i.Subject,this.webSocketErrors$=new i.Subject}return Object.defineProperty(e.prototype,"stompClient",{get:function(){return this._stompClient},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){var t=Object.assign({},e);t.beforeConnect&&(this._beforeConnect=t.beforeConnect,delete t.beforeConnect),this._stompClient.configure(t),t.debug&&(this._debug=t.debug)},e.prototype.activate=function(){var e=this;this._stompClient.configure({beforeConnect:function(){return o(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this._changeState(c.RxStompState.CONNECTING),[4,this._beforeConnect(this)];case 1:return e.sent(),[2]}}))}))},onConnect:function(t){e._serverHeadersBehaviourSubject$.next(t.headers),e._changeState(c.RxStompState.OPEN)},onStompError:function(t){e.stompErrors$.next(t)},onWebSocketClose:function(){e._changeState(c.RxStompState.CLOSED)},onUnhandledMessage:function(t){e.unhandledMessage$.next(t)},onUnhandledReceipt:function(t){e.unhandledReceipts$.next(t)},onUnhandledFrame:function(t){e.unhandledFrame$.next(t)},onWebSocketError:function(t){e.webSocketErrors$.next(t)}}),this._stompClient.activate()},e.prototype.deactivate=function(){this._stompClient.deactivate();var e=this.connectionState$.getValue();e===c.RxStompState.OPEN&&this._changeState(c.RxStompState.CLOSING),e===c.RxStompState.CONNECTING&&this._changeState(c.RxStompState.CLOSED)},e.prototype.connected=function(){return this.connectionState$.getValue()===c.RxStompState.OPEN},Object.defineProperty(e.prototype,"active",{get:function(){return this.stompClient.active},enumerable:!0,configurable:!0}),e.prototype.publish=function(e){var t=null==e.retryIfDisconnected||e.retryIfDisconnected;if(this.connected())this._stompClient.publish(e);else{if(!t)throw new Error("Cannot publish while broker is not connected");this._debug("Not connected, queueing"),this._queuedMessages.push(e)}},e.prototype._sendQueuedMessages=function(){var e=this._queuedMessages;if(this._queuedMessages=[],0!==e.length){this._debug("Will try sending  "+e.length+" queued message(s)");for(var t=0,n=e;t<n.length;t++){var o=n[t];this._debug("Attempting to send "+o),this.publish(o)}}},e.prototype.watch=function(e,t){var n=this;return void 0===t&&(t={}),this._debug("Request to subscribe "+e),t.ack||(t.ack="auto"),i.Observable.create((function(o){var r,i;return i=n._connectedPre$.subscribe((function(){n._debug("Will subscribe to "+e),r=n._stompClient.subscribe(e,(function(e){o.next(e)}),t)})),function(){n._debug("Stop watching connection state (for "+e+")"),i.unsubscribe(),n.connected()?(n._debug("Will unsubscribe from "+e+" at Stomp"),r.unsubscribe()):n._debug("Stomp not connected, no need to unsubscribe from "+e+" at Stomp")}})).pipe(u.share())},e.prototype.watchForReceipt=function(e,t){this._stompClient.watchForReceipt(e,t)},e.prototype._changeState=function(e){this._connectionStatePre$.next(e),this.connectionState$.next(e)},e}();t.RxStomp=a},function(e,t){e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){};t.RxStompRPCConfig=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(1),i=n(10),u=function(){function e(e,t){var n=this;this.rxStomp=e,this.stompRPCConfig=t,this._replyQueueName="/temp-queue/rpc-replies",this._setupReplyQueue=function(){return n.rxStomp.unhandledMessage$},t&&(t.replyQueueName&&(this._replyQueueName=t.replyQueueName),t.setupReplyQueue&&(this._setupReplyQueue=t.setupReplyQueue))}return e.prototype.rpc=function(e){return this.stream(e).pipe(r.first())},e.prototype.stream=function(e){var t=this,n=Object.assign({},e.headers||{}),u=e.destination,s=e.body,c=e.binaryBody;return this._repliesObservable||(this._repliesObservable=this._setupReplyQueue(this._replyQueueName,this.rxStomp)),o.Observable.create((function(e){var o,a=n["correlation-id"]||i.UUID.UUID();return o=t._repliesObservable.pipe(r.filter((function(e){return e.headers["correlation-id"]===a}))).subscribe((function(t){e.next(t)})),n["reply-to"]=t._replyQueueName,n["correlation-id"]=a,t.rxStomp.publish({destination:u,body:s,binaryBody:c,headers:n}),function(){o.unsubscribe()}}))},e}();t.RxStompRPC=u},function(e,t,n){"use strict";var o=function(){function e(){}return e.UUID=function(){if("undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.getRandomValues){var e=new Uint16Array(8);return window.crypto.getRandomValues(e),this.pad4(e[0])+this.pad4(e[1])+"-"+this.pad4(e[2])+"-"+this.pad4(e[3])+"-"+this.pad4(e[4])+"-"+this.pad4(e[5])+this.pad4(e[6])+this.pad4(e[7])}return this.random4()+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+"-"+this.random4()+this.random4()+this.random4()},e.pad4=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t},e.random4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e}();t.UUID=o}])}));
//# sourceMappingURL=rx-stomp.umd.min.js.map