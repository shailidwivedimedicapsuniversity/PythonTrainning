import * as tslib_1 from "tslib";
import { computeGroupState, isGroupState } from '../state';
import { ensureState } from './util';
function updateGroupControlsState(updateFns) {
    return function (state) {
        var hasChanged = false;
        var newControls = Object.keys(state.controls).reduce(function (res, key) {
            var _a, _b;
            var control = state.controls[key];
            Object.assign(res, (_a = {}, _a[key] = control, _a));
            if (updateFns.hasOwnProperty(key)) {
                var newControl = updateFns[key](control, state);
                hasChanged = hasChanged || newControl !== control;
                Object.assign(res, (_b = {}, _b[key] = newControl, _b));
            }
            return res;
        }, {});
        return hasChanged ? newControls : state.controls;
    };
}
function updateGroupSingle(updateFns) {
    return function (state) {
        var newControls = updateGroupControlsState(updateFns)(state);
        return newControls !== state.controls
            ? computeGroupState(state.id, newControls, state.value, state.errors, state.pendingValidations, state.userDefinedProperties, {
                wasOrShouldBeDirty: state.isDirty,
                wasOrShouldBeEnabled: state.isEnabled,
                wasOrShouldBeTouched: state.isTouched,
                wasOrShouldBeSubmitted: state.isSubmitted,
            })
            : state;
    };
}
export function updateGroup(stateOrUpdateFnOrUpdateFnArray, updateFnOrUpdateFnArr) {
    var rest = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        rest[_i - 2] = arguments[_i];
    }
    if (isGroupState(stateOrUpdateFnOrUpdateFnArray)) {
        var updateFnArr_1 = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr_1.concat.apply(updateFnArr_1, tslib_1.__spread(rest)).reduce(function (s, updateFn) { return updateGroupSingle(updateFn)(s); }, stateOrUpdateFnOrUpdateFnArray);
    }
    var updateFnArr = Array.isArray(stateOrUpdateFnOrUpdateFnArray) ? stateOrUpdateFnOrUpdateFnArray : [stateOrUpdateFnOrUpdateFnArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return function (s) { return updateGroup(ensureState(s), updateFnArr.concat(rest)); };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLWdyb3VwLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmdyeC1mb3Jtcy8iLCJzb3VyY2VzIjpbInNyYy91cGRhdGUtZnVuY3Rpb24vdXBkYXRlLWdyb3VwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQWdELFlBQVksRUFBWSxNQUFNLFVBQVUsQ0FBQztBQUNuSCxPQUFPLEVBQUUsV0FBVyxFQUFjLE1BQU0sUUFBUSxDQUFDO0FBTWpELFNBQVMsd0JBQXdCLENBQTBCLFNBQWlDO0lBQzFGLE9BQU8sVUFBQyxLQUE2QjtRQUNuQyxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUM7UUFDdkIsSUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7O1lBQzlELElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLFlBQUksR0FBQyxHQUFHLElBQUcsT0FBTyxNQUFHLENBQUM7WUFDdkMsSUFBSSxTQUFTLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNqQyxJQUFNLFVBQVUsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUNuRCxVQUFVLEdBQUcsVUFBVSxJQUFJLFVBQVUsS0FBSyxPQUFPLENBQUM7Z0JBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxZQUFJLEdBQUMsR0FBRyxJQUFHLFVBQVUsTUFBRyxDQUFDO2FBQzNDO1lBQ0QsT0FBTyxHQUFHLENBQUM7UUFDYixDQUFDLEVBQUUsRUFBK0IsQ0FBQyxDQUFDO1FBQ3BDLE9BQU8sVUFBVSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7SUFDbkQsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELFNBQVMsaUJBQWlCLENBQTBCLFNBQWlDO0lBQ25GLE9BQU8sVUFBQyxLQUE2QjtRQUNuQyxJQUFNLFdBQVcsR0FBRyx3QkFBd0IsQ0FBUyxTQUFTLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2RSxPQUFPLFdBQVcsS0FBSyxLQUFLLENBQUMsUUFBUTtZQUNuQyxDQUFDLENBQUMsaUJBQWlCLENBQ2pCLEtBQUssQ0FBQyxFQUFFLEVBQ1IsV0FBVyxFQUNYLEtBQUssQ0FBQyxLQUFLLEVBQ1gsS0FBSyxDQUFDLE1BQU0sRUFDWixLQUFLLENBQUMsa0JBQWtCLEVBQ3hCLEtBQUssQ0FBQyxxQkFBcUIsRUFDM0I7Z0JBQ0Usa0JBQWtCLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ2pDLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUNyQyxvQkFBb0IsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDckMsc0JBQXNCLEVBQUUsS0FBSyxDQUFDLFdBQVc7YUFDMUMsQ0FDRjtZQUNELENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDWixDQUFDLENBQUM7QUFDSixDQUFDO0FBZ0pELE1BQU0sVUFBVSxXQUFXLENBQ3pCLDhCQUEwRyxFQUMxRyxxQkFBeUU7SUFDekUsY0FBaUM7U0FBakMsVUFBaUMsRUFBakMscUJBQWlDLEVBQWpDLElBQWlDO1FBQWpDLDZCQUFpQzs7SUFFakMsSUFBSSxZQUFZLENBQVMsOEJBQThCLENBQUMsRUFBRTtRQUN4RCxJQUFNLGFBQVcsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLHFCQUFzQixDQUFDLENBQUM7UUFDNUcsT0FBTyxhQUFXLENBQUMsTUFBTSxPQUFsQixhQUFXLG1CQUFXLElBQUksR0FBRSxNQUFNLENBQUMsVUFBQyxDQUFDLEVBQUUsUUFBUSxJQUFLLE9BQUEsaUJBQWlCLENBQVMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQXRDLENBQXNDLEVBQUUsOEJBQThCLENBQUMsQ0FBQztLQUNwSTtJQUVELElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsOEJBQThCLENBQUMsQ0FBQyxDQUFDLENBQUMsOEJBQThCLENBQUMsQ0FBQyxDQUFDLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUNwSSxXQUFXLEdBQUcscUJBQXFCLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUM1RyxPQUFPLFVBQUMsQ0FBeUIsSUFBSyxPQUFBLFdBQVcsQ0FBUyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUE3RCxDQUE2RCxDQUFDO0FBQ3RHLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb21wdXRlR3JvdXBTdGF0ZSwgRm9ybUdyb3VwQ29udHJvbHMsIEZvcm1Hcm91cFN0YXRlLCBGb3JtU3RhdGUsIGlzR3JvdXBTdGF0ZSwgS2V5VmFsdWUgfSBmcm9tICcuLi9zdGF0ZSc7XHJcbmltcG9ydCB7IGVuc3VyZVN0YXRlLCBQcm9qZWN0Rm4yIH0gZnJvbSAnLi91dGlsJztcclxuXHJcbmV4cG9ydCB0eXBlIFN0YXRlVXBkYXRlRm5zPFRWYWx1ZSBleHRlbmRzIEtleVZhbHVlPiA9IHtcclxuICBbY29udHJvbElkIGluIGtleW9mIFRWYWx1ZV0/OiBQcm9qZWN0Rm4yPEZvcm1TdGF0ZTxUVmFsdWVbY29udHJvbElkXT4sIEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT4+O1xyXG59O1xyXG5cclxuZnVuY3Rpb24gdXBkYXRlR3JvdXBDb250cm9sc1N0YXRlPFRWYWx1ZSBleHRlbmRzIEtleVZhbHVlPih1cGRhdGVGbnM6IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT4pIHtcclxuICByZXR1cm4gKHN0YXRlOiBGb3JtR3JvdXBTdGF0ZTxUVmFsdWU+KSA9PiB7XHJcbiAgICBsZXQgaGFzQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgbmV3Q29udHJvbHMgPSBPYmplY3Qua2V5cyhzdGF0ZS5jb250cm9scykucmVkdWNlKChyZXMsIGtleSkgPT4ge1xyXG4gICAgICBjb25zdCBjb250cm9sID0gc3RhdGUuY29udHJvbHNba2V5XTtcclxuICAgICAgT2JqZWN0LmFzc2lnbihyZXMsIHsgW2tleV06IGNvbnRyb2wgfSk7XHJcbiAgICAgIGlmICh1cGRhdGVGbnMuaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgIGNvbnN0IG5ld0NvbnRyb2wgPSB1cGRhdGVGbnNba2V5XSEoY29udHJvbCwgc3RhdGUpO1xyXG4gICAgICAgIGhhc0NoYW5nZWQgPSBoYXNDaGFuZ2VkIHx8IG5ld0NvbnRyb2wgIT09IGNvbnRyb2w7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyZXMsIHsgW2tleV06IG5ld0NvbnRyb2wgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHJlcztcclxuICAgIH0sIHt9IGFzIEZvcm1Hcm91cENvbnRyb2xzPFRWYWx1ZT4pO1xyXG4gICAgcmV0dXJuIGhhc0NoYW5nZWQgPyBuZXdDb250cm9scyA6IHN0YXRlLmNvbnRyb2xzO1xyXG4gIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUdyb3VwU2luZ2xlPFRWYWx1ZSBleHRlbmRzIEtleVZhbHVlPih1cGRhdGVGbnM6IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT4pIHtcclxuICByZXR1cm4gKHN0YXRlOiBGb3JtR3JvdXBTdGF0ZTxUVmFsdWU+KTogRm9ybUdyb3VwU3RhdGU8VFZhbHVlPiA9PiB7XHJcbiAgICBjb25zdCBuZXdDb250cm9scyA9IHVwZGF0ZUdyb3VwQ29udHJvbHNTdGF0ZTxUVmFsdWU+KHVwZGF0ZUZucykoc3RhdGUpO1xyXG4gICAgcmV0dXJuIG5ld0NvbnRyb2xzICE9PSBzdGF0ZS5jb250cm9sc1xyXG4gICAgICA/IGNvbXB1dGVHcm91cFN0YXRlPFRWYWx1ZT4oXHJcbiAgICAgICAgc3RhdGUuaWQsXHJcbiAgICAgICAgbmV3Q29udHJvbHMsXHJcbiAgICAgICAgc3RhdGUudmFsdWUsXHJcbiAgICAgICAgc3RhdGUuZXJyb3JzLFxyXG4gICAgICAgIHN0YXRlLnBlbmRpbmdWYWxpZGF0aW9ucyxcclxuICAgICAgICBzdGF0ZS51c2VyRGVmaW5lZFByb3BlcnRpZXMsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgd2FzT3JTaG91bGRCZURpcnR5OiBzdGF0ZS5pc0RpcnR5LFxyXG4gICAgICAgICAgd2FzT3JTaG91bGRCZUVuYWJsZWQ6IHN0YXRlLmlzRW5hYmxlZCxcclxuICAgICAgICAgIHdhc09yU2hvdWxkQmVUb3VjaGVkOiBzdGF0ZS5pc1RvdWNoZWQsXHJcbiAgICAgICAgICB3YXNPclNob3VsZEJlU3VibWl0dGVkOiBzdGF0ZS5pc1N1Ym1pdHRlZCxcclxuICAgICAgICB9LFxyXG4gICAgICApXHJcbiAgICAgIDogc3RhdGU7XHJcbiAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIG9uZSBvciBtb3JlIHVwZGF0ZSBmdW5jdGlvbiBvYmplY3RzIGFuZCByZXR1cm5zXHJcbiAqIGEgcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIG9iamVjdHMgb25lIGFmdGVyIGFub3RoZXIgdG8gYSBmb3JtXHJcbiAqIGdyb3VwIHN0YXRlLlxyXG4gKlxyXG4gKiBUaGUgZm9sbG93aW5nIChjb250cml2ZWQpIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIHRoZSBjaGlsZFxyXG4gKiBjb250cm9sIGBuYW1lYCB0byBiZSByZXF1aXJlZCBhbmQgc2V0IHRoZSBjaGlsZCBjb250cm9sIGBlbWFpbGAncyB2YWx1ZSB0b1xyXG4gKiBiZSBgJydgIGlmIHRoZSBuYW1lIGlzIGludmFsaWQuXHJcbiAqXHJcbmBgYHR5cGVzY3JpcHRcclxuaW50ZXJmYWNlIEZvcm1WYWx1ZSB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbn1cclxuXHJcbmNvbnN0IGdyb3VwVXBkYXRlRm4gPSB1cGRhdGVHcm91cDxGb3JtVmFsdWU+KFxyXG4gIHtcclxuICAgIG5hbWU6IHZhbGlkYXRlPHN0cmluZz4ocmVxdWlyZWQpLFxyXG4gIH0sXHJcbiAge1xyXG4gICAgZW1haWw6IChlbWFpbCwgcGFyZW50R3JvdXApID0+XHJcbiAgICAgIHBhcmVudEdyb3VwLmNvbnRyb2xzLm5hbWUuaXNJbnZhbGlkXHJcbiAgICAgICAgPyBzZXRWYWx1ZSgnJywgZW1haWwpXHJcbiAgICAgICAgOiBlbWFpbCxcclxuICB9LFxyXG4pO1xyXG5jb25zdCB1cGRhdGVkU3RhdGUgPSBncm91cFVwZGF0ZUZuKHN0YXRlKTtcclxuYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlR3JvdXA8VFZhbHVlPihcclxuICB1cGRhdGVGbjogU3RhdGVVcGRhdGVGbnM8VFZhbHVlPixcclxuICAuLi51cGRhdGVGbnNBcnI6IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT5bXVxyXG4pOiAoc3RhdGU6IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT4pID0+IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT47XHJcblxyXG4vKipcclxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYW4gYXJyYXkgb2YgdXBkYXRlIGZ1bmN0aW9uIG9iamVjdHMgYW5kXHJcbiAqIHJldHVybnMgYSBwcm9qZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyBhbGwgb2JqZWN0cyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xyXG4gKiBhIGZvcm0gZ3JvdXAgc3RhdGUuXHJcbiAqXHJcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgdGhlIGNoaWxkXHJcbiAqIGNvbnRyb2wgYG5hbWVgIHRvIGJlIHJlcXVpcmVkIGFuZCBzZXQgdGhlIGNoaWxkIGNvbnRyb2wgYGVtYWlsYCdzIHZhbHVlIHRvXHJcbiAqIGJlIGAnJ2AgaWYgdGhlIG5hbWUgaXMgaW52YWxpZC5cclxuICpcclxuYGBgdHlwZXNjcmlwdFxyXG5pbnRlcmZhY2UgRm9ybVZhbHVlIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxufVxyXG5cclxuY29uc3QgZ3JvdXBVcGRhdGVGbiA9IHVwZGF0ZUdyb3VwPEZvcm1WYWx1ZT4oXHJcbiAgW1xyXG4gICAge1xyXG4gICAgICBuYW1lOiB2YWxpZGF0ZTxzdHJpbmc+KHJlcXVpcmVkKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGVtYWlsOiAoZW1haWwsIHBhcmVudEdyb3VwKSA9PlxyXG4gICAgICAgIHBhcmVudEdyb3VwLmNvbnRyb2xzLm5hbWUuaXNJbnZhbGlkXHJcbiAgICAgICAgICA/IHNldFZhbHVlKCcnLCBlbWFpbClcclxuICAgICAgICAgIDogZW1haWwsXHJcbiAgICB9LFxyXG4gIF0sXHJcbik7XHJcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IGdyb3VwVXBkYXRlRm4oc3RhdGUpO1xyXG5gYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVHcm91cDxUVmFsdWU+KFxyXG4gIHVwZGF0ZUZuc0FycjogU3RhdGVVcGRhdGVGbnM8VFZhbHVlPltdLFxyXG4pOiAoc3RhdGU6IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT4pID0+IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT47XHJcblxyXG4vKipcclxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGdyb3VwIHN0YXRlIGFuZCBvbmUgb3IgbW9yZSB1cGRhdGVcclxuICogZnVuY3Rpb24gb2JqZWN0cyBhbmQgYXBwbGllcyBhbGwgb2JqZWN0cyBvbmUgYWZ0ZXIgYW5vdGhlciB0byB0aGUgc3RhdGUuXHJcbiAqIFByb3ZpZGluZyBtdWx0aXBsZSB1cGRhdGUgZnVuY3Rpb24gb2JqZWN0cyBpcyBtYWlubHkgdXNlZnVsIGlmIHRoZSByZXN1bHRcclxuICogb2YgYSBsYXRlciBvYmplY3QgZGVwZW5kcyBvbiB0aGUgcmVzdWx0IG9mIHByZXZpb3VzIG9iamVjdHMuXHJcbiAqXHJcbiAqIFRoZSBmb2xsb3dpbmcgKGNvbnRyaXZlZCkgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgdGhlIGNoaWxkXHJcbiAqIGNvbnRyb2wgYG5hbWVgIHRvIGJlIHJlcXVpcmVkIGFuZCBzZXQgdGhlIGNoaWxkIGNvbnRyb2wgYGVtYWlsYCdzIHZhbHVlIHRvXHJcbiAqIGJlIGAnJ2AgaWYgdGhlIG5hbWUgaXMgaW52YWxpZC5cclxuICpcclxuYGBgdHlwZXNjcmlwdFxyXG5pbnRlcmZhY2UgRm9ybVZhbHVlIHtcclxuICBuYW1lOiBzdHJpbmc7XHJcbiAgZW1haWw6IHN0cmluZztcclxufVxyXG5cclxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlR3JvdXA8Rm9ybVZhbHVlPihcclxuICBzdGF0ZSxcclxuICB7XHJcbiAgICBuYW1lOiB2YWxpZGF0ZTxzdHJpbmc+KHJlcXVpcmVkKSxcclxuICB9LFxyXG4gIHtcclxuICAgIGVtYWlsOiAoZW1haWwsIHBhcmVudEdyb3VwKSA9PlxyXG4gICAgICBwYXJlbnRHcm91cC5jb250cm9scy5uYW1lLmlzSW52YWxpZFxyXG4gICAgICAgID8gc2V0VmFsdWUoJycsIGVtYWlsKVxyXG4gICAgICAgIDogZW1haWwsXHJcbiAgfSxcclxuKTtcclxuYGBgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlR3JvdXA8VFZhbHVlPihcclxuICBzdGF0ZTogRm9ybUdyb3VwU3RhdGU8VFZhbHVlPixcclxuICB1cGRhdGVGbjogU3RhdGVVcGRhdGVGbnM8VFZhbHVlPixcclxuICAuLi51cGRhdGVGbnNBcnI6IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT5bXVxyXG4pOiBGb3JtR3JvdXBTdGF0ZTxUVmFsdWU+O1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBncm91cCBzdGF0ZSBhbmQgYW4gYXJyYXkgb2YgdXBkYXRlXHJcbiAqIGZ1bmN0aW9uIG9iamVjdHMgYW5kIGFwcGxpZXMgYWxsIG9iamVjdHMgb25lIGFmdGVyIGFub3RoZXIgdG8gdGhlIHN0YXRlLlxyXG4gKiBQcm92aWRpbmcgbXVsdGlwbGUgdXBkYXRlIGZ1bmN0aW9uIG9iamVjdHMgaXMgbWFpbmx5IHVzZWZ1bCBpZiB0aGUgcmVzdWx0XHJcbiAqIG9mIGEgbGF0ZXIgb2JqZWN0IGRlcGVuZHMgb24gdGhlIHJlc3VsdCBvZiBwcmV2aW91cyBvYmplY3RzLlxyXG4gKlxyXG4gKiBUaGUgZm9sbG93aW5nIChjb250cml2ZWQpIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIHRoZSBjaGlsZFxyXG4gKiBjb250cm9sIGBuYW1lYCB0byBiZSByZXF1aXJlZCBhbmQgc2V0IHRoZSBjaGlsZCBjb250cm9sIGBlbWFpbGAncyB2YWx1ZSB0b1xyXG4gKiBiZSBgJydgIGlmIHRoZSBuYW1lIGlzIGludmFsaWQuXHJcbiAqXHJcbmBgYHR5cGVzY3JpcHRcclxuaW50ZXJmYWNlIEZvcm1WYWx1ZSB7XHJcbiAgbmFtZTogc3RyaW5nO1xyXG4gIGVtYWlsOiBzdHJpbmc7XHJcbn1cclxuXHJcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZUdyb3VwPEZvcm1WYWx1ZT4oXHJcbiAgc3RhdGUsXHJcbiAgW1xyXG4gICAge1xyXG4gICAgICBuYW1lOiB2YWxpZGF0ZTxzdHJpbmc+KHJlcXVpcmVkKSxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGVtYWlsOiAoZW1haWwsIHBhcmVudEdyb3VwKSA9PlxyXG4gICAgICAgIHBhcmVudEdyb3VwLmNvbnRyb2xzLm5hbWUuaXNJbnZhbGlkXHJcbiAgICAgICAgICA/IHNldFZhbHVlKCcnLCBlbWFpbClcclxuICAgICAgICAgIDogZW1haWwsXHJcbiAgICB9LFxyXG4gIF0sXHJcbik7XHJcbmBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUdyb3VwPFRWYWx1ZT4oXHJcbiAgc3RhdGU6IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT4sXHJcbiAgdXBkYXRlRm5zQXJyOiBTdGF0ZVVwZGF0ZUZuczxUVmFsdWU+W10sXHJcbik6IEZvcm1Hcm91cFN0YXRlPFRWYWx1ZT47XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlR3JvdXA8VFZhbHVlIGV4dGVuZHMgS2V5VmFsdWU+KFxyXG4gIHN0YXRlT3JVcGRhdGVGbk9yVXBkYXRlRm5BcnJheTogRm9ybUdyb3VwU3RhdGU8VFZhbHVlPiB8IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT4gfCBTdGF0ZVVwZGF0ZUZuczxUVmFsdWU+W10sXHJcbiAgdXBkYXRlRm5PclVwZGF0ZUZuQXJyPzogU3RhdGVVcGRhdGVGbnM8VFZhbHVlPiB8IFN0YXRlVXBkYXRlRm5zPFRWYWx1ZT5bXSxcclxuICAuLi5yZXN0OiBTdGF0ZVVwZGF0ZUZuczxUVmFsdWU+W11cclxuKSB7XHJcbiAgaWYgKGlzR3JvdXBTdGF0ZTxUVmFsdWU+KHN0YXRlT3JVcGRhdGVGbk9yVXBkYXRlRm5BcnJheSkpIHtcclxuICAgIGNvbnN0IHVwZGF0ZUZuQXJyID0gQXJyYXkuaXNBcnJheSh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpID8gdXBkYXRlRm5PclVwZGF0ZUZuQXJyIDogW3VwZGF0ZUZuT3JVcGRhdGVGbkFyciFdO1xyXG4gICAgcmV0dXJuIHVwZGF0ZUZuQXJyLmNvbmNhdCguLi5yZXN0KS5yZWR1Y2UoKHMsIHVwZGF0ZUZuKSA9PiB1cGRhdGVHcm91cFNpbmdsZTxUVmFsdWU+KHVwZGF0ZUZuKShzKSwgc3RhdGVPclVwZGF0ZUZuT3JVcGRhdGVGbkFycmF5KTtcclxuICB9XHJcblxyXG4gIGxldCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkoc3RhdGVPclVwZGF0ZUZuT3JVcGRhdGVGbkFycmF5KSA/IHN0YXRlT3JVcGRhdGVGbk9yVXBkYXRlRm5BcnJheSA6IFtzdGF0ZU9yVXBkYXRlRm5PclVwZGF0ZUZuQXJyYXldO1xyXG4gIHVwZGF0ZUZuQXJyID0gdXBkYXRlRm5PclVwZGF0ZUZuQXJyID09PSB1bmRlZmluZWQgPyB1cGRhdGVGbkFyciA6IHVwZGF0ZUZuQXJyLmNvbmNhdCh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpO1xyXG4gIHJldHVybiAoczogRm9ybUdyb3VwU3RhdGU8VFZhbHVlPikgPT4gdXBkYXRlR3JvdXA8VFZhbHVlPihlbnN1cmVTdGF0ZShzKSwgdXBkYXRlRm5BcnIuY29uY2F0KHJlc3QpKTtcclxufVxyXG4iXX0=