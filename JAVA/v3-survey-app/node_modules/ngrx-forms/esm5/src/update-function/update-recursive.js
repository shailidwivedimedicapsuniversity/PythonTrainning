import * as tslib_1 from "tslib";
import { isArrayState, isFormState, isGroupState, } from '../state';
import { updateArray } from './update-array';
import { updateGroup } from './update-group';
import { ensureState } from './util';
function updateRecursiveSingle(parent, updateFn) {
    return function (state) {
        if (isGroupState(state)) {
            var updateFunctions = Object.keys(state.controls).reduce(function (agg, key) {
                var _a;
                return Object.assign(agg, (_a = {},
                    _a[key] = function (s, p) { return updateRecursiveSingle(p, updateFn)(s); },
                    _a));
            }, {});
            state = updateGroup(updateFunctions)(state);
            return updateFn(state, parent);
        }
        if (isArrayState(state)) {
            state = updateArray(function (s, p) { return updateRecursiveSingle(p, updateFn)(s); })(state);
            return updateFn(state, parent);
        }
        return updateFn(state, parent);
    };
}
export function updateRecursive(stateOrFunctionOrFunctionArray, updateFnOrUpdateFnArr) {
    var rest = [];
    for (var _i = 2; _i < arguments.length; _i++) {
        rest[_i - 2] = arguments[_i];
    }
    if (isFormState(stateOrFunctionOrFunctionArray)) {
        var updateFnArr_1 = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr_1.concat.apply(updateFnArr_1, tslib_1.__spread(rest)).reduce(function (s, updateFn) { return updateRecursiveSingle(stateOrFunctionOrFunctionArray, updateFn)(s); }, stateOrFunctionOrFunctionArray);
    }
    var updateFnArr = Array.isArray(stateOrFunctionOrFunctionArray) ? stateOrFunctionOrFunctionArray : [stateOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return function (s) { return updateRecursive(ensureState(s), updateFnArr.concat(rest)); };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXJlY3Vyc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25ncngtZm9ybXMvIiwic291cmNlcyI6WyJzcmMvdXBkYXRlLWZ1bmN0aW9uL3VwZGF0ZS1yZWN1cnNpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFHTCxZQUFZLEVBQ1osV0FBVyxFQUNYLFlBQVksR0FDYixNQUFNLFVBQVUsQ0FBQztBQUNsQixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0MsT0FBTyxFQUFrQixXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsV0FBVyxFQUFjLE1BQU0sUUFBUSxDQUFDO0FBRWpELFNBQVMscUJBQXFCLENBQUMsTUFBaUMsRUFBRSxRQUEwRTtJQUMxSSxPQUFPLFVBQUMsS0FBZ0M7UUFDdEMsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdkIsSUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxFQUFFLEdBQUc7O2dCQUFLLE9BQUEsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHO29CQUN4RixHQUFDLEdBQUcsSUFBRyxVQUFDLENBQTRCLEVBQUUsQ0FBNEIsSUFBSyxPQUFBLHFCQUFxQixDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBckMsQ0FBcUM7d0JBQzVHO1lBRnVFLENBRXZFLEVBQUUsRUFBeUIsQ0FBQyxDQUFDO1lBQy9CLEtBQUssR0FBRyxXQUFXLENBQU0sZUFBZSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakQsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdkIsS0FBSyxHQUFHLFdBQVcsQ0FBTSxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQXJDLENBQXFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqRixPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDaEM7UUFFRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDakMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQWdGRCxNQUFNLFVBQVUsZUFBZSxDQUM3Qiw4QkFHc0UsRUFDdEUscUJBQTZKO0lBQzdKLGNBQTJFO1NBQTNFLFVBQTJFLEVBQTNFLHFCQUEyRSxFQUEzRSxJQUEyRTtRQUEzRSw2QkFBMkU7O0lBRTNFLElBQUksV0FBVyxDQUFDLDhCQUE4QixDQUFDLEVBQUU7UUFDL0MsSUFBTSxhQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBc0IsQ0FBQyxDQUFDO1FBQzVHLE9BQU8sYUFBVyxDQUFDLE1BQU0sT0FBbEIsYUFBVyxtQkFBVyxJQUFJLEdBQzlCLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxRQUFRLElBQUssT0FBQSxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBbEUsQ0FBa0UsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO0tBQ2hJO0lBRUQsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQ3BJLFdBQVcsR0FBRyxxQkFBcUIsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzVHLE9BQU8sVUFBQyxDQUErQixJQUFLLE9BQUEsZUFBZSxDQUFTLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQWpFLENBQWlFLENBQUM7QUFDaEgsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWJzdHJhY3RDb250cm9sU3RhdGUsXHJcbiAgRm9ybVN0YXRlLFxyXG4gIGlzQXJyYXlTdGF0ZSxcclxuICBpc0Zvcm1TdGF0ZSxcclxuICBpc0dyb3VwU3RhdGUsXHJcbn0gZnJvbSAnLi4vc3RhdGUnO1xyXG5pbXBvcnQgeyB1cGRhdGVBcnJheSB9IGZyb20gJy4vdXBkYXRlLWFycmF5JztcclxuaW1wb3J0IHsgU3RhdGVVcGRhdGVGbnMsIHVwZGF0ZUdyb3VwIH0gZnJvbSAnLi91cGRhdGUtZ3JvdXAnO1xyXG5pbXBvcnQgeyBlbnN1cmVTdGF0ZSwgUHJvamVjdEZuMiB9IGZyb20gJy4vdXRpbCc7XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmVTaW5nbGUocGFyZW50OiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCB1cGRhdGVGbjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+Pikge1xyXG4gIHJldHVybiAoc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4pOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+ID0+IHtcclxuICAgIGlmIChpc0dyb3VwU3RhdGUoc3RhdGUpKSB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZUZ1bmN0aW9ucyA9IE9iamVjdC5rZXlzKHN0YXRlLmNvbnRyb2xzKS5yZWR1Y2UoKGFnZywga2V5KSA9PiBPYmplY3QuYXNzaWduKGFnZywge1xyXG4gICAgICAgIFtrZXldOiAoczogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgcDogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55PikgPT4gdXBkYXRlUmVjdXJzaXZlU2luZ2xlKHAsIHVwZGF0ZUZuKShzKSxcclxuICAgICAgfSksIHt9IGFzIFN0YXRlVXBkYXRlRm5zPGFueT4pO1xyXG4gICAgICBzdGF0ZSA9IHVwZGF0ZUdyb3VwPGFueT4odXBkYXRlRnVuY3Rpb25zKShzdGF0ZSk7XHJcbiAgICAgIHJldHVybiB1cGRhdGVGbihzdGF0ZSwgcGFyZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNBcnJheVN0YXRlKHN0YXRlKSkge1xyXG4gICAgICBzdGF0ZSA9IHVwZGF0ZUFycmF5PGFueT4oKHMsIHApID0+IHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShwLCB1cGRhdGVGbikocykpKHN0YXRlKTtcclxuICAgICAgcmV0dXJuIHVwZGF0ZUZuKHN0YXRlLCBwYXJlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB1cGRhdGVGbihzdGF0ZSwgcGFyZW50KTtcclxuICB9O1xyXG59XHJcblxyXG4vKipcclxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGFycmF5IHN0YXRlIGFuZCBvbmUgb3IgbW9yZSB1cGRhdGVcclxuICogZnVuY3Rpb25zIGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG8gdGhlIHN0YXRlXHJcbiAqIHJlY3Vyc2l2ZWx5LCBpLmUuIHRoZSBmdW5jdGlvbiBpcyBhcHBsaWVkIHRvIHRoZSBzdGF0ZSdzIGNoaWxkcmVuLFxyXG4gKiB0aGVpciBjaGlsZHJlbiBldGMuXHJcbiAqXHJcbiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGNvbnRyb2xzIGluIGFcclxuICogZ3JvdXAgb3IgYXJyYXkgYXMgcmVxdWlyZWQuXHJcbiAqXHJcbiBgYGB0eXBlc2NyaXB0XHJcbiBjb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVSZWN1cnNpdmUoXHJcbiAgIHN0YXRlLFxyXG4gICB2YWxpZGF0ZTxhbnk+KHJlcXVpcmVkKSxcclxuICk7XHJcbiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmU8VFZhbHVlPihcclxuICBzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPixcclxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PixcclxuICAuLi51cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdXHJcbik6IEZvcm1TdGF0ZTxUVmFsdWU+O1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIGEgZm9ybSBhcnJheSBzdGF0ZSBhbmQgYW4gYXJyYXkgb2ZcclxuICogdXBkYXRlIGZ1bmN0aW9ucyBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvIHRoZVxyXG4gKiBzdGF0ZSByZWN1cnNpdmVseSwgaS5lLiB0aGUgZnVuY3Rpb24gaXMgYXBwbGllZCB0byB0aGUgc3RhdGUncyBjaGlsZHJlbixcclxuICogdGhlaXIgY2hpbGRyZW4gZXRjLlxyXG4gKlxyXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXHJcbiAqIGdyb3VwIG9yIGFycmF5IGFzIHJlcXVpcmVkLlxyXG4gKlxyXG5gYGB0eXBlc2NyaXB0XHJcbmNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZVJlY3Vyc2l2ZShcclxuICBzdGF0ZSxcclxuICBbdmFsaWRhdGU8YW55PihyZXF1aXJlZCldLFxyXG4pO1xyXG5gYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmU8VFZhbHVlPihcclxuICBzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPixcclxuICB1cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxyXG4pOiBGb3JtU3RhdGU8VFZhbHVlPjtcclxuXHJcbi8qKlxyXG4gKiBUaGlzIHVwZGF0ZSBmdW5jdGlvbiB0YWtlcyBvbmUgb3IgbW9yZSB1cGRhdGUgZnVuY3Rpb25zIGFuZCByZXR1cm5zIGFcclxuICogcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG9cclxuICogYSBmb3JtIHN0YXRlLlxyXG4gKlxyXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXHJcbiAqIGdyb3VwIGFzIHJlcXVpcmVkLlxyXG4gKlxyXG5gYGB0eXBlc2NyaXB0XHJcbmNvbnN0IHVwZGF0ZUZuID0gdXBkYXRlUmVjdXJzaXZlKHZhbGlkYXRlPGFueT4ocmVxdWlyZWQpKTtcclxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlRm4oc3RhdGUpO1xyXG5gYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmUoXHJcbiAgdXBkYXRlRm46IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj4sXHJcbiAgLi4udXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXVxyXG4pOiA8VFZhbHVlPihzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPikgPT4gRm9ybVN0YXRlPFRWYWx1ZT47XHJcblxyXG4vKipcclxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYW4gYXJyYXkgb2YgdXBkYXRlIGZ1bmN0aW9ucyBhbmQgcmV0dXJuc1xyXG4gKiBhIHByb2plY3Rpb24gZnVuY3Rpb24gdGhhdCBhcHBsaWVzIGFsbCB1cGRhdGUgZnVuY3Rpb25zIG9uZSBhZnRlciBhbm90aGVyIHRvXHJcbiAqIGEgZm9ybSBzdGF0ZS5cclxuICpcclxuICogVGhlIGZvbGxvd2luZyBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgY29udHJvbHMgaW4gYVxyXG4gKiBncm91cCBhcyByZXF1aXJlZC5cclxuICpcclxuYGBgdHlwZXNjcmlwdFxyXG5jb25zdCB1cGRhdGVGbiA9IHVwZGF0ZVJlY3Vyc2l2ZShbdmFsaWRhdGU8YW55PihyZXF1aXJlZCldKTtcclxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlRm4oc3RhdGUpO1xyXG5gYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVSZWN1cnNpdmUoXHJcbiAgdXBkYXRlRm5BcnI6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcclxuKTogPFRWYWx1ZT4oc3RhdGU6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4pID0+IEZvcm1TdGF0ZTxUVmFsdWU+O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KFxyXG4gIHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheTpcclxuICAgIHwgQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPlxyXG4gICAgfCBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+XHJcbiAgICB8IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXSxcclxuICB1cGRhdGVGbk9yVXBkYXRlRm5BcnI/OiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+IHwgUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxyXG4gIC4uLnJlc3Q6IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5bXVxyXG4pIHtcclxuICBpZiAoaXNGb3JtU3RhdGUoc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5KSkge1xyXG4gICAgY29uc3QgdXBkYXRlRm5BcnIgPSBBcnJheS5pc0FycmF5KHVwZGF0ZUZuT3JVcGRhdGVGbkFycikgPyB1cGRhdGVGbk9yVXBkYXRlRm5BcnIgOiBbdXBkYXRlRm5PclVwZGF0ZUZuQXJyIV07XHJcbiAgICByZXR1cm4gdXBkYXRlRm5BcnIuY29uY2F0KC4uLnJlc3QpXHJcbiAgICAgIC5yZWR1Y2UoKHMsIHVwZGF0ZUZuKSA9PiB1cGRhdGVSZWN1cnNpdmVTaW5nbGUoc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5LCB1cGRhdGVGbikocyksIHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSk7XHJcbiAgfVxyXG5cclxuICBsZXQgdXBkYXRlRm5BcnIgPSBBcnJheS5pc0FycmF5KHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSkgPyBzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkgOiBbc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5XTtcclxuICB1cGRhdGVGbkFyciA9IHVwZGF0ZUZuT3JVcGRhdGVGbkFyciA9PT0gdW5kZWZpbmVkID8gdXBkYXRlRm5BcnIgOiB1cGRhdGVGbkFyci5jb25jYXQodXBkYXRlRm5PclVwZGF0ZUZuQXJyKTtcclxuICByZXR1cm4gKHM6IEFic3RyYWN0Q29udHJvbFN0YXRlPFRWYWx1ZT4pID0+IHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KGVuc3VyZVN0YXRlKHMpLCB1cGRhdGVGbkFyci5jb25jYXQocmVzdCkpO1xyXG59XHJcbiJdfQ==