import { isArrayState, isFormState, isGroupState, } from '../state';
import { updateArray } from './update-array';
import { updateGroup } from './update-group';
import { ensureState } from './util';
function updateRecursiveSingle(parent, updateFn) {
    return (state) => {
        if (isGroupState(state)) {
            const updateFunctions = Object.keys(state.controls).reduce((agg, key) => Object.assign(agg, {
                [key]: (s, p) => updateRecursiveSingle(p, updateFn)(s),
            }), {});
            state = updateGroup(updateFunctions)(state);
            return updateFn(state, parent);
        }
        if (isArrayState(state)) {
            state = updateArray((s, p) => updateRecursiveSingle(p, updateFn)(s))(state);
            return updateFn(state, parent);
        }
        return updateFn(state, parent);
    };
}
export function updateRecursive(stateOrFunctionOrFunctionArray, updateFnOrUpdateFnArr, ...rest) {
    if (isFormState(stateOrFunctionOrFunctionArray)) {
        const updateFnArr = Array.isArray(updateFnOrUpdateFnArr) ? updateFnOrUpdateFnArr : [updateFnOrUpdateFnArr];
        return updateFnArr.concat(...rest)
            .reduce((s, updateFn) => updateRecursiveSingle(stateOrFunctionOrFunctionArray, updateFn)(s), stateOrFunctionOrFunctionArray);
    }
    let updateFnArr = Array.isArray(stateOrFunctionOrFunctionArray) ? stateOrFunctionOrFunctionArray : [stateOrFunctionOrFunctionArray];
    updateFnArr = updateFnOrUpdateFnArr === undefined ? updateFnArr : updateFnArr.concat(updateFnOrUpdateFnArr);
    return (s) => updateRecursive(ensureState(s), updateFnArr.concat(rest));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlLXJlY3Vyc2l2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25ncngtZm9ybXMvIiwic291cmNlcyI6WyJzcmMvdXBkYXRlLWZ1bmN0aW9uL3VwZGF0ZS1yZWN1cnNpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdMLFlBQVksRUFDWixXQUFXLEVBQ1gsWUFBWSxHQUNiLE1BQU0sVUFBVSxDQUFDO0FBQ2xCLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQWtCLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdELE9BQU8sRUFBRSxXQUFXLEVBQWMsTUFBTSxRQUFRLENBQUM7QUFFakQsU0FBUyxxQkFBcUIsQ0FBQyxNQUFpQyxFQUFFLFFBQTBFO0lBQzFJLE9BQU8sQ0FBQyxLQUFnQyxFQUE2QixFQUFFO1FBQ3JFLElBQUksWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO2dCQUMxRixDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBNEIsRUFBRSxDQUE0QixFQUFFLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzdHLENBQUMsRUFBRSxFQUF5QixDQUFDLENBQUM7WUFDL0IsS0FBSyxHQUFHLFdBQVcsQ0FBTSxlQUFlLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqRCxPQUFPLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDaEM7UUFFRCxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUN2QixLQUFLLEdBQUcsV0FBVyxDQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMscUJBQXFCLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDakYsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsT0FBTyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFnRkQsTUFBTSxVQUFVLGVBQWUsQ0FDN0IsOEJBR3NFLEVBQ3RFLHFCQUE2SixFQUM3SixHQUFHLElBQXdFO0lBRTNFLElBQUksV0FBVyxDQUFDLDhCQUE4QixDQUFDLEVBQUU7UUFDL0MsTUFBTSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxxQkFBc0IsQ0FBQyxDQUFDO1FBQzVHLE9BQU8sV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMvQixNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQyw4QkFBOEIsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSw4QkFBOEIsQ0FBQyxDQUFDO0tBQ2hJO0lBRUQsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQ3BJLFdBQVcsR0FBRyxxQkFBcUIsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0lBQzVHLE9BQU8sQ0FBQyxDQUErQixFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQVMsV0FBVyxDQUFDLENBQUMsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNoSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBYnN0cmFjdENvbnRyb2xTdGF0ZSxcclxuICBGb3JtU3RhdGUsXHJcbiAgaXNBcnJheVN0YXRlLFxyXG4gIGlzRm9ybVN0YXRlLFxyXG4gIGlzR3JvdXBTdGF0ZSxcclxufSBmcm9tICcuLi9zdGF0ZSc7XHJcbmltcG9ydCB7IHVwZGF0ZUFycmF5IH0gZnJvbSAnLi91cGRhdGUtYXJyYXknO1xyXG5pbXBvcnQgeyBTdGF0ZVVwZGF0ZUZucywgdXBkYXRlR3JvdXAgfSBmcm9tICcuL3VwZGF0ZS1ncm91cCc7XHJcbmltcG9ydCB7IGVuc3VyZVN0YXRlLCBQcm9qZWN0Rm4yIH0gZnJvbSAnLi91dGlsJztcclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShwYXJlbnQ6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIHVwZGF0ZUZuOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+KSB7XHJcbiAgcmV0dXJuIChzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pik6IEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4gPT4ge1xyXG4gICAgaWYgKGlzR3JvdXBTdGF0ZShzdGF0ZSkpIHtcclxuICAgICAgY29uc3QgdXBkYXRlRnVuY3Rpb25zID0gT2JqZWN0LmtleXMoc3RhdGUuY29udHJvbHMpLnJlZHVjZSgoYWdnLCBrZXkpID0+IE9iamVjdC5hc3NpZ24oYWdnLCB7XHJcbiAgICAgICAgW2tleV06IChzOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBwOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+KSA9PiB1cGRhdGVSZWN1cnNpdmVTaW5nbGUocCwgdXBkYXRlRm4pKHMpLFxyXG4gICAgICB9KSwge30gYXMgU3RhdGVVcGRhdGVGbnM8YW55Pik7XHJcbiAgICAgIHN0YXRlID0gdXBkYXRlR3JvdXA8YW55Pih1cGRhdGVGdW5jdGlvbnMpKHN0YXRlKTtcclxuICAgICAgcmV0dXJuIHVwZGF0ZUZuKHN0YXRlLCBwYXJlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc0FycmF5U3RhdGUoc3RhdGUpKSB7XHJcbiAgICAgIHN0YXRlID0gdXBkYXRlQXJyYXk8YW55PigocywgcCkgPT4gdXBkYXRlUmVjdXJzaXZlU2luZ2xlKHAsIHVwZGF0ZUZuKShzKSkoc3RhdGUpO1xyXG4gICAgICByZXR1cm4gdXBkYXRlRm4oc3RhdGUsIHBhcmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHVwZGF0ZUZuKHN0YXRlLCBwYXJlbnQpO1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUaGlzIHVwZGF0ZSBmdW5jdGlvbiB0YWtlcyBhIGZvcm0gYXJyYXkgc3RhdGUgYW5kIG9uZSBvciBtb3JlIHVwZGF0ZVxyXG4gKiBmdW5jdGlvbnMgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0byB0aGUgc3RhdGVcclxuICogcmVjdXJzaXZlbHksIGkuZS4gdGhlIGZ1bmN0aW9uIGlzIGFwcGxpZWQgdG8gdGhlIHN0YXRlJ3MgY2hpbGRyZW4sXHJcbiAqIHRoZWlyIGNoaWxkcmVuIGV0Yy5cclxuICpcclxuICogVGhlIGZvbGxvd2luZyBleGFtcGxlIHVzZXMgdGhpcyBmdW5jdGlvbiB0byB2YWxpZGF0ZSBhbGwgY29udHJvbHMgaW4gYVxyXG4gKiBncm91cCBvciBhcnJheSBhcyByZXF1aXJlZC5cclxuICpcclxuIGBgYHR5cGVzY3JpcHRcclxuIGNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHVwZGF0ZVJlY3Vyc2l2ZShcclxuICAgc3RhdGUsXHJcbiAgIHZhbGlkYXRlPGFueT4ocmVxdWlyZWQpLFxyXG4gKTtcclxuIGBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KFxyXG4gIHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+LFxyXG4gIHVwZGF0ZUZuOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+LFxyXG4gIC4uLnVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W11cclxuKTogRm9ybVN0YXRlPFRWYWx1ZT47XHJcblxyXG4vKipcclxuICogVGhpcyB1cGRhdGUgZnVuY3Rpb24gdGFrZXMgYSBmb3JtIGFycmF5IHN0YXRlIGFuZCBhbiBhcnJheSBvZlxyXG4gKiB1cGRhdGUgZnVuY3Rpb25zIGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG8gdGhlXHJcbiAqIHN0YXRlIHJlY3Vyc2l2ZWx5LCBpLmUuIHRoZSBmdW5jdGlvbiBpcyBhcHBsaWVkIHRvIHRoZSBzdGF0ZSdzIGNoaWxkcmVuLFxyXG4gKiB0aGVpciBjaGlsZHJlbiBldGMuXHJcbiAqXHJcbiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGNvbnRyb2xzIGluIGFcclxuICogZ3JvdXAgb3IgYXJyYXkgYXMgcmVxdWlyZWQuXHJcbiAqXHJcbmBgYHR5cGVzY3JpcHRcclxuY29uc3QgdXBkYXRlZFN0YXRlID0gdXBkYXRlUmVjdXJzaXZlKFxyXG4gIHN0YXRlLFxyXG4gIFt2YWxpZGF0ZTxhbnk+KHJlcXVpcmVkKV0sXHJcbik7XHJcbmBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZTxUVmFsdWU+KFxyXG4gIHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+LFxyXG4gIHVwZGF0ZUZuQXJyOiBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W10sXHJcbik6IEZvcm1TdGF0ZTxUVmFsdWU+O1xyXG5cclxuLyoqXHJcbiAqIFRoaXMgdXBkYXRlIGZ1bmN0aW9uIHRha2VzIG9uZSBvciBtb3JlIHVwZGF0ZSBmdW5jdGlvbnMgYW5kIHJldHVybnMgYVxyXG4gKiBwcm9qZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYXBwbGllcyBhbGwgdXBkYXRlIGZ1bmN0aW9ucyBvbmUgYWZ0ZXIgYW5vdGhlciB0b1xyXG4gKiBhIGZvcm0gc3RhdGUuXHJcbiAqXHJcbiAqIFRoZSBmb2xsb3dpbmcgZXhhbXBsZSB1c2VzIHRoaXMgZnVuY3Rpb24gdG8gdmFsaWRhdGUgYWxsIGNvbnRyb2xzIGluIGFcclxuICogZ3JvdXAgYXMgcmVxdWlyZWQuXHJcbiAqXHJcbmBgYHR5cGVzY3JpcHRcclxuY29uc3QgdXBkYXRlRm4gPSB1cGRhdGVSZWN1cnNpdmUodmFsaWRhdGU8YW55PihyZXF1aXJlZCkpO1xyXG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVGbihzdGF0ZSk7XHJcbmBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZShcclxuICB1cGRhdGVGbjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PixcclxuICAuLi51cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdXHJcbik6IDxUVmFsdWU+KHN0YXRlOiBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+KSA9PiBGb3JtU3RhdGU8VFZhbHVlPjtcclxuXHJcbi8qKlxyXG4gKiBUaGlzIHVwZGF0ZSBmdW5jdGlvbiB0YWtlcyBhbiBhcnJheSBvZiB1cGRhdGUgZnVuY3Rpb25zIGFuZCByZXR1cm5zXHJcbiAqIGEgcHJvamVjdGlvbiBmdW5jdGlvbiB0aGF0IGFwcGxpZXMgYWxsIHVwZGF0ZSBmdW5jdGlvbnMgb25lIGFmdGVyIGFub3RoZXIgdG9cclxuICogYSBmb3JtIHN0YXRlLlxyXG4gKlxyXG4gKiBUaGUgZm9sbG93aW5nIGV4YW1wbGUgdXNlcyB0aGlzIGZ1bmN0aW9uIHRvIHZhbGlkYXRlIGFsbCBjb250cm9scyBpbiBhXHJcbiAqIGdyb3VwIGFzIHJlcXVpcmVkLlxyXG4gKlxyXG5gYGB0eXBlc2NyaXB0XHJcbmNvbnN0IHVwZGF0ZUZuID0gdXBkYXRlUmVjdXJzaXZlKFt2YWxpZGF0ZTxhbnk+KHJlcXVpcmVkKV0pO1xyXG5jb25zdCB1cGRhdGVkU3RhdGUgPSB1cGRhdGVGbihzdGF0ZSk7XHJcbmBgYFxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVJlY3Vyc2l2ZShcclxuICB1cGRhdGVGbkFycjogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxyXG4pOiA8VFZhbHVlPihzdGF0ZTogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPikgPT4gRm9ybVN0YXRlPFRWYWx1ZT47XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlUmVjdXJzaXZlPFRWYWx1ZT4oXHJcbiAgc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5OlxyXG4gICAgfCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxUVmFsdWU+XHJcbiAgICB8IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj5cclxuICAgIHwgUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdLFxyXG4gIHVwZGF0ZUZuT3JVcGRhdGVGbkFycj86IFByb2plY3RGbjI8QWJzdHJhY3RDb250cm9sU3RhdGU8YW55PiwgQWJzdHJhY3RDb250cm9sU3RhdGU8YW55Pj4gfCBQcm9qZWN0Rm4yPEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4sIEFic3RyYWN0Q29udHJvbFN0YXRlPGFueT4+W10sXHJcbiAgLi4ucmVzdDogUHJvamVjdEZuMjxBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+LCBBYnN0cmFjdENvbnRyb2xTdGF0ZTxhbnk+PltdXHJcbikge1xyXG4gIGlmIChpc0Zvcm1TdGF0ZShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXkpKSB7XHJcbiAgICBjb25zdCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkodXBkYXRlRm5PclVwZGF0ZUZuQXJyKSA/IHVwZGF0ZUZuT3JVcGRhdGVGbkFyciA6IFt1cGRhdGVGbk9yVXBkYXRlRm5BcnIhXTtcclxuICAgIHJldHVybiB1cGRhdGVGbkFyci5jb25jYXQoLi4ucmVzdClcclxuICAgICAgLnJlZHVjZSgocywgdXBkYXRlRm4pID0+IHVwZGF0ZVJlY3Vyc2l2ZVNpbmdsZShzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXksIHVwZGF0ZUZuKShzKSwgc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5KTtcclxuICB9XHJcblxyXG4gIGxldCB1cGRhdGVGbkFyciA9IEFycmF5LmlzQXJyYXkoc3RhdGVPckZ1bmN0aW9uT3JGdW5jdGlvbkFycmF5KSA/IHN0YXRlT3JGdW5jdGlvbk9yRnVuY3Rpb25BcnJheSA6IFtzdGF0ZU9yRnVuY3Rpb25PckZ1bmN0aW9uQXJyYXldO1xyXG4gIHVwZGF0ZUZuQXJyID0gdXBkYXRlRm5PclVwZGF0ZUZuQXJyID09PSB1bmRlZmluZWQgPyB1cGRhdGVGbkFyciA6IHVwZGF0ZUZuQXJyLmNvbmNhdCh1cGRhdGVGbk9yVXBkYXRlRm5BcnIpO1xyXG4gIHJldHVybiAoczogQWJzdHJhY3RDb250cm9sU3RhdGU8VFZhbHVlPikgPT4gdXBkYXRlUmVjdXJzaXZlPFRWYWx1ZT4oZW5zdXJlU3RhdGUocyksIHVwZGF0ZUZuQXJyLmNvbmNhdChyZXN0KSk7XHJcbn1cclxuIl19